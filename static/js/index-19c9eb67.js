var e=Object.defineProperty,t=(t,s,a)=>(((t,s,a)=>{s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a})(t,"symbol"!=typeof s?s+"":s,a),a);import{a as s,g as a,d as o,h as l,i as r,j as c}from"./element-plus-9cb76cde.js";import{_ as n,a as i,b as u,c as d,d as p}from"./index-f628bbd0.js";import{d as m,r as f,o as v,c as h,h as b,a5 as g,a as S,t as y,a1 as j,a0 as k,_ as x,k as w,l as I,u as _,w as C,am as O,j as N,F as q,B as L,C as R,O as T,a$ as M,a2 as E,i as J,n as D,p as U,m as z}from"./@vue-04694376.js";import{d as P}from"./vuedraggable-948b4deb.js";import{o as V,G as B,M as A,d as H}from"./registerMaterialOptionsCom-273ddf1a.js";import{s as Y}from"./pinia-4f831d96.js";import{u as $,b as F}from"./vue-router-55b6b8bf.js";import{c as G}from"./c-scrollbar-c49413b9.js";import{_ as K}from"./logo-dffdf75d.js";import{F as Q}from"./file-saver-cee0e8a2.js";import{h as W}from"./moment-b35f754a.js";import{l as X}from"./lodash-22bc2da3.js";import{b as Z}from"./axios-2c8ed835.js";import"./lodash-es-0eb3dd2b.js";import"./async-validator-efc2d198.js";import"./dayjs-a7ab034a.js";import"./@popperjs-892fd7f5.js";import"./@ctrl-bc5a71ae.js";import"./vue-uuid-aec06620.js";import"./vue-codemirror-4c93d05b.js";import"./codemirror-57406601.js";import"./@codemirror-3be4b538.js";import"./@lezer-639021e9.js";import"./crelt-5248ea80.js";import"./style-mod-5e94de5f.js";import"./w3c-keyname-f6e73d09.js";import"./@element-plus-d59b4640.js";import"./colorpicker-v3-ac4b8f2e.js";import"./vue-demi-5b9a0fa5.js";import"./vue-bcc994de.js";import"./sortablejs-01cffe89.js";import"./html2canvas-33a3bd31.js";import"./jspdf-1f2cf1da.js";const ee=n(m({__name:"Title",props:{title:{default:"模块选择"},showCollapse:{type:Boolean}},emits:["unflodOrCollapse"],setup(e,{emit:t}){const a=f("收起"),o=f(!0),l=f(null),r=()=>{o.value?(a.value="展开",o.value=!1,l.value.style.transform="rotate(180deg)"):(a.value="收起",o.value=!0,l.value.style.transform="rotate(0deg)"),t("unflodOrCollapse",o.value)};return(t,c)=>{const n=i,u=s;return v(),h("div",{class:I(["title",{"collapse-center":!o.value}])},[b(S("h1",null,y(e.title),513),[[g,o.value]]),e.showCollapse?(v(),j(u,{key:0,class:"box-item",effect:"dark",content:a.value},{default:k((()=>[S("div",{ref_key:"switchRef",ref:l,class:"unfold-collapse-box",onClick:r},[x(n,{"icon-name":"icon-shouqi",color:"#00c091",size:"24px"})],512)])),_:1},8,["content"])):w("",!0)],2)}}}),[["__scopeId","data-v-491b972e"]]),te={class:"model-list-box"},se={key:0,class:"model-ul"},ae=["onClick"],oe={class:"left"},le={class:"right"},re=n(m({__name:"ModelList",props:{leftShowStatus:null},setup(e){const{resumeJsonNewStore:t}=u.useResumeJsonNewStore,{updateSelectModel:o}=u.useSelectMaterialStore,l=()=>{},r=()=>{};return(c,n)=>{const d=i,p=s,m=a;return v(),h("div",te,[_(t).COMPONENTS.length?(v(),h("div",se,[x(_(P),{list:_(t).COMPONENTS,"item-key":"id","ghost-class":"ghost","chosen-class":"chosenClass",animation:"300",onStart:l,onEnd:r},{item:k((({element:t})=>[S("div",{class:I(["model-list-item",{active:_(u).useSelectMaterialStore.cptKeyId==t.keyId},{"collapse-center":!e.leftShowStatus}]),onClick:e=>(e=>{let t=e.cptOptionsName,s={model:e.model,optionsName:t,title:e.data.title,keyId:e.keyId};o(s.model,s.optionsName,s.title,s.keyId)})(t)},[S("div",oe,[S("div",{class:I(["icon-box",{"collapse-size":!e.leftShowStatus}])},[x(p,{class:"box-item",placement:"right",effect:"dark",content:t.data.title,disabled:e.leftShowStatus},{default:k((()=>[x(d,{"icon-name":t.data.iconfont?t.data.iconfont:"icon-xingquaihao","class-name":"icon",color:e.leftShowStatus?"#c4c4c4":"#00c091",size:"16px"},null,8,["icon-name","color"])])),_:2},1032,["content","disabled"])],2),b(S("p",null,y(t.data.title),513),[[g,e.leftShowStatus]])]),b(S("div",le,[x(m,{modelValue:t.show,"onUpdate:modelValue":e=>t.show=e,size:"small","active-color":"#00C091"},null,8,["modelValue","onUpdate:modelValue"])],512),[[g,e.leftShowStatus]])],10,ae)])),_:1},8,["list"])])):w("",!0)])}}}),[["__scopeId","data-v-f02ebe52"]]),ce={class:"nav-box"},ne={class:"nav-center"},ie={class:"draft-tips"},ue={class:"nav-right"},de=m({__name:"DesignNav",emits:["generateReport","reset","saveDataToLocal"],setup(e,{emit:t}){let{resumeJsonNewStore:a}=Y(u.useResumeJsonNewStore);const n=$(),{name:p}=n.query,m=F(),I=()=>{m.push({path:"/"})},L=f(null),R=f(!1),T=()=>{R.value=!0,L.value.focus()},M=()=>{R.value=!1};let E=f("");const J=()=>{let e=a.value.ID,t={},s=localStorage.getItem("resumeDraft");s?(t=JSON.parse(s),t[e]=a.value):t[e]=a.value,localStorage.setItem("resumeDraft",JSON.stringify(t));const o=W(new Date).format("YYYY.MM.DD HH:mm:ss");E.value=`已自动保存草稿  ${o}`},D=()=>{J(),o({message:"保存草稿成功!",type:"success",center:!0})},U=X.exports.debounce((()=>{J()}),1e3);C((()=>a.value),(()=>{U()}),{deep:!0});const z=()=>{const e=JSON.stringify(a.value,null,4),t=new Blob([e],{type:""});Q.saveAs(t,a.value.TITLE+".json")},P=()=>{t("generateReport")},V=()=>{l.confirm("此操作会重置简历至初始状态，是否继续?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{t("reset"),E.value=""})).catch((()=>{}))},B=f(!1),A=()=>{B.value=!0},H=()=>{B.value=!1};return(e,t)=>{const o=O("Edit"),l=r,n=c,u=i,m=s;return v(),h(q,null,[S("nav",ce,[S("div",{class:"nav-left"},[S("img",{src:K,alt:"logo",srcset:"",onClick:I}),S("span",{onClick:I},"化简")]),S("div",ne,[S("span",ie,y(_(E)),1),b(S("p",null,[N(y(_(a).TITLE)+" ",1),x(l,{size:20,color:"#409eff",onClick:T},{default:k((()=>[x(o)])),_:1})],512),[[g,!R.value]]),b(x(n,{ref_key:"titleIpf",ref:L,modelValue:_(a).TITLE,"onUpdate:modelValue":t[0]||(t[0]=e=>_(a).TITLE=e),autofocus:"",placeholder:"请输入标题",onBlur:M},null,8,["modelValue"]),[[g,R.value]])]),S("div",ue,[x(m,{class:"box-item",effect:"dark",content:"保存草稿",placement:"bottom"},{default:k((()=>[S("div",{class:"icon-box",onClick:D},[x(u,{"icon-name":"icon-caogaoxiang1",color:"#fff",size:"17px"})])])),_:1}),x(m,{class:"box-item",effect:"dark",content:"导出为PDF",placement:"bottom"},{default:k((()=>[S("div",{class:"icon-box",onClick:P},[x(u,{"icon-name":"icon-pdf",color:"#fff",size:"17px"})])])),_:1}),x(m,{class:"box-item",effect:"dark",content:"导出为JSON数据",placement:"bottom"},{default:k((()=>[S("div",{class:"icon-box",onClick:z},[x(u,{"icon-name":"icon-xiazai",color:"#fff",size:"17px"})])])),_:1}),"custom"===_(p)?(v(),j(m,{key:0,class:"box-item",effect:"dark",content:"导入JSON数据",placement:"bottom"},{default:k((()=>[S("div",{class:"icon-box",onClick:A},[x(u,{"icon-name":"icon-yunduanshangchuan",color:"#fff",size:"19px"})])])),_:1})):w("",!0),x(m,{class:"box-item",effect:"dark",content:"重置所有设置",placement:"bottom"},{default:k((()=>[S("div",{class:"icon-box",onClick:V},[x(u,{"icon-name":"icon-zhongzhi",color:"#fff",size:"17px"})])])),_:1})])]),x(d,{"dialog-visible":B.value,onCancle:H},null,8,["dialog-visible"])],64)}}});const pe=new class{constructor(e){t(this,"instance"),t(this,"interceptorsObj"),t(this,"cancelRequestSourceList"),t(this,"requestUrlList"),this.requestUrlList=[],this.cancelRequestSourceList=[],this.instance=Z.create(e),this.interceptorsObj=e.interceptors,this.instance.interceptors.request.use((e=>e),(e=>e)),this.instance.interceptors.request.use(this.interceptorsObj?.requestInterceptors,this.interceptorsObj?.requestInterceptorsCatch),this.instance.interceptors.response.use(this.interceptorsObj?.responseInterceptors,this.interceptorsObj?.responseInterceptorsCatch),this.instance.interceptors.response.use((e=>e.data),(e=>e))}getSourceIndex(e){return this.cancelRequestSourceList?.findIndex((t=>Object.keys(t)[0]===e))}delUrl(e){const t=this.requestUrlList?.findIndex((t=>t===e)),s=this.getSourceIndex(e);-1!==t&&this.requestUrlList?.splice(t,1),-1!==s&&this.cancelRequestSourceList?.splice(s,1)}request(e){return new Promise(((t,s)=>{e.interceptors?.requestInterceptors&&(e=e.interceptors.requestInterceptors(e));const a=e.url;a&&(this.requestUrlList?.push(a),e.cancelToken=new Z.CancelToken((e=>{this.cancelRequestSourceList?.push({[a]:e})}))),this.instance.request(e).then((s=>{e.interceptors?.responseInterceptors&&(s=e.interceptors.responseInterceptors(s)),t(s)})).catch((e=>{s(e)})).finally((()=>{a&&this.delUrl(a)}))}))}cancelRequest(e){if("string"==typeof e){const t=this.getSourceIndex(e);t>=0&&this.cancelRequestSourceList?.[t][e]()}else e.forEach((e=>{const t=this.getSourceIndex(e);t>=0&&this.cancelRequestSourceList?.[t][e]()}))}cancelAllRequest(){this.cancelRequestSourceList?.forEach((e=>{e[Object.keys(e)[0]]()}))}}({baseURL:"https://smallpig.site/api",timeout:3e5,interceptors:{requestInterceptors:e=>e,responseInterceptors:e=>e}}),me={class:"design-box"},fe={class:"bottom"},ve=(e=>(U("data-v-cb272014"),e=e(),z(),e))((()=>S("p",{class:"tips"},"如果分割线遮挡内容，请通过调整模块上下边距以显示内容！",-1))),he={class:"page"},be=n(m({__name:"index",setup(e){const{cptTitle:t}=Y(u.useSelectMaterialStore),{changeResumeJsonData:s}=u.useResumeJsonNewStore,{refreshUuid:a}=Y(u.useUuidStore),{setUuid:l}=u.useUuidStore,{resumeJsonNewStore:r,importJson:c}=Y(u.useResumeJsonNewStore),n=async()=>{let e;const t=`${location.origin}/json/${b}/template.json`,a=await(e=>pe.request({url:e,method:"get"}))(t);e=a,e.ID=m,e.NAME=b,e.COMPONENTS.forEach((e=>{e.data=A[e.model]})),s(e),l()},i=localStorage.getItem("resumeDraft"),d=$(),{id:m,name:b}=d.query;if(r.value.ID=m,r.value.NAME=b,i){let e=JSON.parse(i)[m];e?s(e):n()}else n();L((async()=>{Q(),X(),await R(),p()})),T((()=>{P?.disconnect()})),M((()=>{O=[]}));const{resetSelectModel:g}=u.useSelectMaterialStore,I=()=>{g()},C=f(null);let O=[];const N=async()=>{n(),I();let e=localStorage.getItem("resumeDraft");if(e){let t=JSON.parse(e);Object.keys(t).length>1?t[m]&&(delete t[m],localStorage.setItem("resumeDraft",JSON.stringify(t))):localStorage.removeItem("resumeDraft")}o({message:"重置成功!",type:"success",center:!0}),l(),await R(),Q()},U=async()=>{let e=K.value;K.value=0,g(),await R(),H(C.value,r.value.TITLE,!1,(()=>{K.value=e}))},z=f(null);let P=null,F=0,K=f(0);const Q=()=>{P=new ResizeObserver((async e=>{for(let t of e)F=t.target.offsetHeight,K.value=Math.ceil(F/1160),C.value.style.height=1160*K.value+"px",z.value.style.height=C.value.style.height})),P.observe(z.value)},W=async e=>{z.value.style.height=e+"px",await R(),Q()},X=()=>{window.addEventListener("click",Z)},Z=e=>{te(z.value,e.target)&&I()},te=(e,t)=>!(!e||e===document)&&(e===t||te(e.parentNode,t));T((()=>{window.removeEventListener("click",Z)}));const se=f(null),ae=f(!0),oe=e=>{e?(setTimeout((()=>{ae.value=e}),100),se.value.style.width="300px"):(setTimeout((()=>{ae.value=e}),100),se.value.style.width="70px")};return(e,s)=>(v(),h("div",me,[x(de,{onGenerateReport:U,onReset:N}),S("div",fe,[S("div",{ref_key:"leftRef",ref:se,class:"left"},[x(_(G.exports.CScrollbar),{trigger:"hover"},{default:k((()=>[x(ee,{"show-collapse":"",onUnflodOrCollapse:oe}),(v(),j(re,{key:_(a),"left-show-status":_(ae)},null,8,["left-show-status"]))])),_:1})],512),(v(),h("div",{key:_(a),class:"center"},[S("div",{ref_key:"html2Pdf",ref:C,class:"design"},[S("div",{ref_key:"htmlContentPdf",ref:z,class:"design-content"},[(v(),j(E("custom"),{onContentHeightChange:W},null,32))],512),_(K)>0?(v(!0),h(q,{key:0},J(_(K),((e,t)=>(v(),h("div",{ref_for:!0,ref:e=>((e,t)=>{e&&(K.value===t+1&&(e.style.top=1160*K.value+"px"),O.push(e))})(e,t),key:t,class:"lines",style:D({top:1128+1132*t+"px"})},[ve,S("p",he,y(t+1)+"/"+y(_(K)),1)],4)))),128)):w("",!0)],512)])),(v(),h("div",{key:_(a),class:"config"},[x(ee,{title:_(t)},null,8,["title"]),x(_(G.exports.CScrollbar),{trigger:"hover","h-thumb-style":{"background-color":"rgba(0,0,0,0.4)"}},{default:k((()=>[_(u).useSelectMaterialStore.cptName?(v(),j(E(_(V)[_(u).useSelectMaterialStore.cptOptionsName]),{key:_(u).useSelectMaterialStore.cptKeyId})):(v(),j(B,{key:1}))])),_:1},8,["h-thumb-style"])]))])]))}}),[["__scopeId","data-v-cb272014"]]);export{be as default};
