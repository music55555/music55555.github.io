var e=Object.defineProperty,t=(t,s,a)=>(((t,s,a)=>{s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a})(t,"symbol"!=typeof s?s+"":s,a),a);import{e as s,r as a,o,c as l,i as n,v as c,b as r,Q as i,g as u,w as d,k as p,G as f,x as m,H as h,j as v,X as S,a1 as g,s as b,y,a2 as k,l as x,A as w,f as I,K as O,O as C,h as q,P as N,a3 as _,a4 as R,a5 as L,a6 as T,a7 as M,W as j,a8 as E,a9 as J,aa as D,ab as U,F as z,R as P,D as V,p as A,a as B}from"./.pnpm-f038f7dc.js";import{_ as H,a as Y,b as G,c as K,d as $}from"./index-c25cf355.js";import{o as F,G as Q,M as W,d as X}from"./registerMaterialOptionsCom-57e44bc0.js";import{_ as Z}from"./logo-dffdf75d.js";const ee=H(s({props:{title:{default:"模块选择"},showCollapse:{type:Boolean}},emits:["unflodOrCollapse"],setup(e,{emit:t}){const s=a("收起"),v=a(!0),S=a(null),g=()=>{v.value?(s.value="展开",v.value=!1,S.value.style.transform="rotate(180deg)"):(s.value="收起",v.value=!0,S.value.style.transform="rotate(0deg)"),t("unflodOrCollapse",v.value)};return(t,a)=>{const b=Y,y=h;return o(),l("div",{class:m(["title",{"collapse-center":!v.value}])},[n(r("h1",null,i(e.title),513),[[c,v.value]]),e.showCollapse?(o(),u(y,{key:0,class:"box-item",effect:"dark",content:s.value},{default:d((()=>[r("div",{ref_key:"switchRef",ref:S,class:"unfold-collapse-box",onClick:g},[p(b,{"icon-name":"icon-shouqi",color:"#00c091",size:"24px"})],512)])),_:1},8,["content"])):f("",!0)],2)}}}),[["__scopeId","data-v-491b972e"]]),te={class:"model-list-box"},se={key:0,class:"model-ul"},ae=["onClick"],oe={class:"left"},le={class:"right"},ne=H(s({props:{leftShowStatus:null},setup(e){const{resumeJsonNewStore:t}=G.useResumeJsonNewStore,{updateSelectModel:s}=G.useSelectMaterialStore,a=()=>{},u=()=>{};return(b,y)=>{const k=Y,x=h,w=g;return o(),l("div",te,[v(t).COMPONENTS.length?(o(),l("div",se,[p(v(S),{list:v(t).COMPONENTS,"item-key":"id","ghost-class":"ghost","chosen-class":"chosenClass",animation:"300",onStart:a,onEnd:u},{item:d((({element:t})=>[r("div",{class:m(["model-list-item",{active:v(G).useSelectMaterialStore.cptKeyId==t.keyId},{"collapse-center":!e.leftShowStatus}]),onClick:e=>(e=>{let t=e.cptOptionsName,a={model:e.model,optionsName:t,title:e.data.title,keyId:e.keyId};s(a.model,a.optionsName,a.title,a.keyId)})(t)},[r("div",oe,[r("div",{class:m(["icon-box",{"collapse-size":!e.leftShowStatus}])},[p(x,{class:"box-item",placement:"right",effect:"dark",content:t.data.title,disabled:e.leftShowStatus},{default:d((()=>[p(k,{"icon-name":t.data.iconfont?t.data.iconfont:"icon-xingquaihao","class-name":"icon",color:e.leftShowStatus?"#c4c4c4":"#00c091",size:"16px"},null,8,["icon-name","color"])])),_:2},1032,["content","disabled"])],2),n(r("p",null,i(t.data.title),513),[[c,e.leftShowStatus]])]),n(r("div",le,[p(w,{modelValue:t.show,"onUpdate:modelValue":e=>t.show=e,size:"small","active-color":"#00C091"},null,8,["modelValue","onUpdate:modelValue"])],512),[[c,e.leftShowStatus]])],10,ae)])),_:1},8,["list"])])):f("",!0)])}}}),[["__scopeId","data-v-f02ebe52"]]),ce={class:"nav-box"},re={class:"nav-center"},ie={class:"draft-tips"},ue={class:"nav-right"},de=s({emits:["generateReport","reset","saveDataToLocal"],setup(e,{emit:t}){let{resumeJsonNewStore:s}=b(G.useResumeJsonNewStore);const m=y(),{name:S}=m.query,g=k(),M=()=>{g.push({path:"/"})},j=a(null),E=a(!1),J=()=>{E.value=!0,j.value.focus()},D=()=>{E.value=!1};let U=a("");const z=()=>{let e=s.value.ID,t={},a=localStorage.getItem("resumeDraft");a?(t=JSON.parse(a),t[e]=s.value):t[e]=s.value,localStorage.setItem("resumeDraft",JSON.stringify(t));const o=q(new Date).format("YYYY.MM.DD HH:mm:ss");U.value=`已自动保存草稿  ${o}`},P=()=>{z(),N({message:"保存草稿成功!",type:"success",center:!0})},V=x.exports.debounce((()=>{z()}),1e3);w((()=>s.value),(()=>{V()}),{deep:!0});const A=()=>{const e=JSON.stringify(s.value,null,4),t=new Blob([e],{type:""});_.saveAs(t,s.value.TITLE+".json")},B=()=>{t("generateReport")},H=()=>{R.confirm("此操作会重置简历至初始状态，是否继续?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{t("reset"),U.value=""})).catch((()=>{}))},$=a(!1),F=()=>{$.value=!0},Q=()=>{$.value=!1};return(e,t)=>{const a=I("Edit"),m=L,g=T,b=Y,y=h;return o(),l(C,null,[r("nav",ce,[r("div",{class:"nav-left"},[r("img",{src:Z,alt:"logo",srcset:"",onClick:M}),r("span",{onClick:M},"化简")]),r("div",re,[r("span",ie,i(v(U)),1),n(r("p",null,[O(i(v(s).TITLE)+" ",1),p(m,{size:20,color:"#409eff",onClick:J},{default:d((()=>[p(a)])),_:1})],512),[[c,!E.value]]),n(p(g,{ref_key:"titleIpf",ref:j,modelValue:v(s).TITLE,"onUpdate:modelValue":t[0]||(t[0]=e=>v(s).TITLE=e),autofocus:"",placeholder:"请输入标题",onBlur:D},null,8,["modelValue"]),[[c,E.value]])]),r("div",ue,[p(y,{class:"box-item",effect:"dark",content:"保存草稿",placement:"bottom"},{default:d((()=>[r("div",{class:"icon-box",onClick:P},[p(b,{"icon-name":"icon-caogaoxiang1",color:"#fff",size:"17px"})])])),_:1}),p(y,{class:"box-item",effect:"dark",content:"导出为PDF",placement:"bottom"},{default:d((()=>[r("div",{class:"icon-box",onClick:B},[p(b,{"icon-name":"icon-pdf",color:"#fff",size:"17px"})])])),_:1}),p(y,{class:"box-item",effect:"dark",content:"导出为JSON数据",placement:"bottom"},{default:d((()=>[r("div",{class:"icon-box",onClick:A},[p(b,{"icon-name":"icon-xiazai",color:"#fff",size:"17px"})])])),_:1}),"custom"===v(S)?(o(),u(y,{key:0,class:"box-item",effect:"dark",content:"导入JSON数据",placement:"bottom"},{default:d((()=>[r("div",{class:"icon-box",onClick:F},[p(b,{"icon-name":"icon-yunduanshangchuan",color:"#fff",size:"19px"})])])),_:1})):f("",!0),p(y,{class:"box-item",effect:"dark",content:"重置所有设置",placement:"bottom"},{default:d((()=>[r("div",{class:"icon-box",onClick:H},[p(b,{"icon-name":"icon-zhongzhi",color:"#fff",size:"17px"})])])),_:1})])]),p(K,{"dialog-visible":$.value,onCancle:Q},null,8,["dialog-visible"])],64)}}});const pe=new class{constructor(e){t(this,"instance"),t(this,"interceptorsObj"),t(this,"cancelRequestSourceList"),t(this,"requestUrlList"),this.requestUrlList=[],this.cancelRequestSourceList=[],this.instance=M.create(e),this.interceptorsObj=e.interceptors,this.instance.interceptors.request.use((e=>e),(e=>e)),this.instance.interceptors.request.use(this.interceptorsObj?.requestInterceptors,this.interceptorsObj?.requestInterceptorsCatch),this.instance.interceptors.response.use(this.interceptorsObj?.responseInterceptors,this.interceptorsObj?.responseInterceptorsCatch),this.instance.interceptors.response.use((e=>e.data),(e=>e))}getSourceIndex(e){return this.cancelRequestSourceList?.findIndex((t=>Object.keys(t)[0]===e))}delUrl(e){const t=this.requestUrlList?.findIndex((t=>t===e)),s=this.getSourceIndex(e);-1!==t&&this.requestUrlList?.splice(t,1),-1!==s&&this.cancelRequestSourceList?.splice(s,1)}request(e){return new Promise(((t,s)=>{e.interceptors?.requestInterceptors&&(e=e.interceptors.requestInterceptors(e));const a=e.url;a&&(this.requestUrlList?.push(a),e.cancelToken=new M.CancelToken((e=>{this.cancelRequestSourceList?.push({[a]:e})}))),this.instance.request(e).then((s=>{e.interceptors?.responseInterceptors&&(s=e.interceptors.responseInterceptors(s)),t(s)})).catch((e=>{s(e)})).finally((()=>{a&&this.delUrl(a)}))}))}cancelRequest(e){if("string"==typeof e){const t=this.getSourceIndex(e);t>=0&&this.cancelRequestSourceList?.[t][e]()}else e.forEach((e=>{const t=this.getSourceIndex(e);t>=0&&this.cancelRequestSourceList?.[t][e]()}))}cancelAllRequest(){this.cancelRequestSourceList?.forEach((e=>{e[Object.keys(e)[0]]()}))}}({baseURL:"https://smallpig.site/api",timeout:3e5,interceptors:{requestInterceptors:e=>e,responseInterceptors:e=>e}}),fe={class:"design-box"},me={class:"bottom"},he=(e=>(A("data-v-cb272014"),e=e(),B(),e))((()=>r("p",{class:"tips"},"如果分割线遮挡内容，请通过调整模块上下边距以显示内容！",-1))),ve={class:"page"},Se=H(s({setup(e){const{cptTitle:t}=b(G.useSelectMaterialStore),{changeResumeJsonData:s}=G.useResumeJsonNewStore,{refreshUuid:n}=b(G.useUuidStore),{setUuid:c}=G.useUuidStore,{resumeJsonNewStore:m,importJson:h}=b(G.useResumeJsonNewStore),S=async()=>{let e;const t=`${location.origin}/json/${w}/template.json`,a=await(e=>pe.request({url:e,method:"get"}))(t);e=a,e.ID=x,e.NAME=w,e.COMPONENTS.forEach((e=>{e.data=W[e.model]})),s(e),c()},g=localStorage.getItem("resumeDraft"),k=y(),{id:x,name:w}=k.query;if(m.value.ID=x,m.value.NAME=w,g){let e=JSON.parse(g)[x];e?s(e):S()}else S();j((async()=>{H(),K(),await E(),$()})),J((()=>{M?.disconnect()})),D((()=>{_=[]}));const{resetSelectModel:I}=G.useSelectMaterialStore,O=()=>{I()},q=a(null);let _=[];const R=async()=>{S(),O();let e=localStorage.getItem("resumeDraft");if(e){let t=JSON.parse(e);Object.keys(t).length>1?t[x]&&(delete t[x],localStorage.setItem("resumeDraft",JSON.stringify(t))):localStorage.removeItem("resumeDraft")}N({message:"重置成功!",type:"success",center:!0}),c(),await E(),H()},L=async()=>{let e=B.value;B.value=0,I(),await E(),X(q.value,m.value.TITLE,!1,(()=>{B.value=e}))},T=a(null);let M=null,A=0,B=a(0);const H=()=>{M=new ResizeObserver((async e=>{for(let t of e)A=t.target.offsetHeight,B.value=Math.ceil(A/1160),q.value.style.height=1160*B.value+"px",T.value.style.height=q.value.style.height})),M.observe(T.value)},Y=async e=>{T.value.style.height=e+"px",await E(),H()},K=()=>{window.addEventListener("click",Z)},Z=e=>{te(T.value,e.target)&&O()},te=(e,t)=>!(!e||e===document)&&(e===t||te(e.parentNode,t));J((()=>{window.removeEventListener("click",Z)}));const se=a(null),ae=a(!0),oe=e=>{e?(setTimeout((()=>{ae.value=e}),100),se.value.style.width="300px"):(setTimeout((()=>{ae.value=e}),100),se.value.style.width="70px")};return(e,s)=>(o(),l("div",fe,[p(de,{onGenerateReport:L,onReset:R}),r("div",me,[r("div",{ref_key:"leftRef",ref:se,class:"left"},[p(v(U.exports.CScrollbar),{trigger:"hover"},{default:d((()=>[p(ee,{"show-collapse":"",onUnflodOrCollapse:oe}),(o(),u(ne,{key:v(n),"left-show-status":ae.value},null,8,["left-show-status"]))])),_:1})],512),(o(),l("div",{key:v(n),class:"center"},[r("div",{ref_key:"html2Pdf",ref:q,class:"design"},[r("div",{ref_key:"htmlContentPdf",ref:T,class:"design-content"},[(o(),u(z("custom"),{onContentHeightChange:Y}))],512),v(B)>0?(o(!0),l(C,{key:0},P(v(B),((e,t)=>(o(),l("div",{ref_for:!0,ref:e=>((e,t)=>{e&&(B.value===t+1&&(e.style.top=1160*B.value+"px"),_.push(e))})(e,t),key:t,class:"lines",style:V({top:1128+1132*t+"px"})},[he,r("p",ve,i(t+1)+"/"+i(v(B)),1)],4)))),128)):f("",!0)],512)])),(o(),l("div",{key:v(n),class:"config"},[p(ee,{title:v(t)},null,8,["title"]),p(v(U.exports.CScrollbar),{trigger:"hover","h-thumb-style":{"background-color":"rgba(0,0,0,0.4)"}},{default:d((()=>[v(G).useSelectMaterialStore.cptName?(o(),u(z(v(F)[v(G).useSelectMaterialStore.cptOptionsName]),{key:v(G).useSelectMaterialStore.cptKeyId})):(o(),u(Q,{key:1}))])),_:1},8,["h-thumb-style"])]))])]))}}),[["__scopeId","data-v-cb272014"]]);export{Se as default};
